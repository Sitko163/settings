МАНУАЛ ПО РАЗВОРАЧИВАНИЮ СЕРВИСА



<================= 1 ЭТАП - Установка Docker =================>

Скачайте и установите Docker Desktop. При установке на ОС семейства Windows установите дополнительные компоненты WSL (устанавливаются автоматически при первом запуске Docker Desktop).


<================= 2 ЭТАП - Подготовка к запуску =================>

Создайте файл .env (Рекомендуется переименовать .env_example на .env и заменить стандартные значения на свои)

Создайте рабочую среду в мессенджере телеграм. Выберите пользователя который будет принимать или отклонять заявки
на подключение к боту от пилотов. Укажите id этого пользователя в .env файле в поле TG_ADMIN. Создайте групповой
чат для отчетов. Укажите его id в поле TG_GROUP_ID (всегда начинается с -100). ОПЦИОНАЛЬНО - Вы можете разделять отчеты по классам дронов. Для этого нужно создать два топика в чате для отчетов КТ и СТ. В .env файле в поле TG_TOPIC_KT необходимо указать id сообщения из топика отчетов КТ, аналогично в поле TG_TOPIC_ST указать id сообщения
из топика отчетов СТ.

Создайте бот телеграм. Для этого используйте тг бот создания ботов @BotFather. Следуйте инструкциям и получите 
уникальный токен Вашего бота. Занесите значение топика в поле TOKEN файла .env.

Добавьте пода в ранее созданный чат, дайте права на отправку сообщений.

Получите ключ API Яндекс карт по ссылке https://developer.tech.yandex.ru/services (JavaScript API и HTTP Геокодер). Вставьте полученный ключ в .env поле YANDEX_API_KEY. 

Сгенерируйте секретный ключ вашего сервиса (можно использовать https://djecrety.ir/) и вставьте его в .env поле SECRET_KEY. 

Укажите пароль базы Redis - поле REDIS_PASSWORD. Укажите этот же пароль и в REDIS_URL
Укажите имя пользователя, пароль и имя базы данных - POSTGRES_USER, POSTGRES_PASSWORD, POSTGRES_DB
Эти же значения укажите в PG_LINK: postgresql://<ВАШЕ_ИМЯ>:<ВАШ_ПАРОЛЬ>@database:5432/<ВАША_БД>

Укажите логин, пароль, (почту при желании) администратора в поля DJANGO_SUPERUSER_USERNAME, DJANGO_SUPERUSER_PASSWORD, DJANGO_SUPERUSER_EMAIL


<================= 3 ЭТАП - Подготовка к работе в сети =================>

Для работы в локальной сети:
	В 32 строке docker-compose.yaml убрать IP адрес, оставить только:
		- "80:80"
	В файле nginx/conf.d/default.conf в 10 строке указать адрес локальной сети

Для работы в глобальной сети:
	Разверните OpenVPN на сервере с белым IP адресом.
	Установите защищенное соединение между серверами (OpenVPN сервером и сервисом (подключается как клиент).
	На сервере OpenVPN настройте веб-прокси на сервис
	В 32 строке docker-compose.yaml замените IP адрес на адрес сервиса в VPN сети


<================= 4 ЭТАП - Запуск сервиса =================>

Зайдите в командную строку в корневую папку проекта (где находится файл docker-compose.yaml)
Выполните команду: docker compose build

После сборки контейнеров, запустите сервис командой: docker compose up -d

В Docker Desktop во вкладке Containers появится статус запущенного сервиса с логами и детальной информацией


<================= 5 ЭТАП - Администрирование =================>

Зайдите в админ-панель по адресу 127.0.0.1/admin
При входе укажите данные из значений DJANGO_SUPERUSER_USERNAME и DJANGO_SUPERUSER_PASSWORD

Заполните таблицы Дроны, Направления, Типы ВВ, Типы взрывателей, Типы коррективов, типы целей
!ВНИМАНИЕ! Каждая таблица из перечисленных должна содержать минимум одну запись для корректного функционирования

Также создайте учетные записи пользователей, которые смогут видеть статистику в веб-приложении. Для пилотов,
использующих бота для заполнения отчетов можно использовать аутентификацию через тг бота


<================= СЕРВИС ГОТОВ К РАБОТЕ =================>

Проверьте функционал. При подключении пользователя на аккаунт администратора придет запрос о подключении
После подтверждения запроса пользователю станет доступна возможность заполнять отчеты.
По всем вопросам обращайтесь к поставщику.
